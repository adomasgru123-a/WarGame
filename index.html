<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country War Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: white;
        }

        /* Country Selection Screen */
        #country-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        #country-selection h1 {
            font-size: 3rem;
            margin-bottom: 50px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .countries-container {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 1200px;
            padding: 0 20px;
        }

        .country-card {
            background: rgba(255,255,255,0.1);
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 120px;
        }

        .country-card:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-5px);
        }

        .country-card.selected {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.3);
        }

        /* Boss Country Cards */
        .country-card.boss-card {
            border: 2px solid #9b59b6;
            background: rgba(155, 89, 182, 0.2);
        }

        .country-card.boss-card:hover {
            background: rgba(155, 89, 182, 0.3);
            box-shadow: 0 0 15px rgba(155, 89, 182, 0.5);
        }

        .country-card.boss-card .country-name {
            color: #9b59b6;
        }

        /* Mythic Country Cards */
        .country-card.mythic-card {
            border: 2px solid #00d4ff;
            background: rgba(0, 212, 255, 0.2);
            animation: mythicCardGlow 2s ease-in-out infinite;
        }

        @keyframes mythicCardGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(0, 212, 255, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.6); }
        }

        .country-card.mythic-card:hover {
            background: rgba(0, 212, 255, 0.3);
        }

        .country-card.mythic-card .country-name {
            color: #00d4ff;
        }

        /* Superboss Country Cards */
        .country-card.superboss-card {
            border: 3px solid #ff0040;
            background: linear-gradient(135deg, rgba(255, 0, 64, 0.3), rgba(139, 0, 0, 0.3));
            animation: superbossCardGlow 1.5s ease-in-out infinite;
        }

        @keyframes superbossCardGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(255, 0, 64, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 0, 64, 0.8); }
        }

        .country-card.superboss-card:hover {
            background: linear-gradient(135deg, rgba(255, 0, 64, 0.4), rgba(139, 0, 0, 0.4));
        }

        .country-card.superboss-card .country-name {
            color: #ff0040;
            font-weight: bold;
        }

        .country-card.superboss-card .country-flag {
            animation: superbossFlagPulse 1s ease-in-out infinite;
        }

        @keyframes superbossFlagPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .country-flag {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .country-name {
            font-size: 1rem;
            font-weight: bold;
        }

        #start-btn {
            padding: 15px 60px;
            font-size: 1.5rem;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.5;
            pointer-events: none;
        }

        #start-btn.active {
            opacity: 1;
            pointer-events: all;
        }

        #start-btn.active:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.5);
        }

        /* Game Screen */
        #game-screen {
            display: none;
            min-height: 100vh;
        }

        .game-header {
            background: rgba(0,0,0,0.3);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-flag {
            font-size: 2rem;
        }

        .player-country {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .resources {
            display: flex;
            gap: 30px;
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .resource-icon {
            font-size: 1.3rem;
        }

        .resource-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .game-content {
            display: flex;
            height: calc(100vh - 70px);
        }

        .main-area {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .units-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
            max-width: 500px;
        }

        .army-display {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
        }

        .army-display h2 {
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .army-count {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4CAF50;
        }

        .army-icon {
            font-size: 2rem;
            margin-top: 5px;
        }

        /* Right Menu */
        .right-menu {
            width: 80px;
            background: rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            padding: 20px 10px;
            gap: 15px;
        }

        .menu-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 10px;
            padding: 15px 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .menu-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 15px rgba(102, 126, 234, 0.5);
        }

        .menu-btn-icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 5px;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: linear-gradient(135deg, #2d3436 0%, #1a1a2e 100%);
            border-radius: 20px;
            padding: 30px;
            min-width: 400px;
            max-width: 500px;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .modal-header h2 {
            font-size: 1.8rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .close-btn:hover {
            opacity: 1;
        }

        /* Shop Items */
        .shop-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shop-item-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .shop-item-icon {
            font-size: 2rem;
        }

        .shop-item-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .shop-item-desc {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .buy-btn {
            background: linear-gradient(135deg, #f39c12, #e74c3c);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .buy-btn:hover {
            transform: scale(1.05);
        }

        .buy-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Stats */
        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .stat-label {
            opacity: 0.8;
        }

        .stat-value {
            font-weight: bold;
            color: #4CAF50;
        }

        /* Settings */
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .toggle-btn {
            background: #555;
            border: none;
            border-radius: 20px;
            width: 50px;
            height: 26px;
            cursor: pointer;
            position: relative;
            transition: background 0.3s;
        }

        .toggle-btn.active {
            background: #4CAF50;
        }

        .toggle-btn::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-btn.active::after {
            left: 26px;
        }

        .reset-btn {
            background: #e74c3c;
            border: none;
            border-radius: 8px;
            padding: 12px 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s;
        }

        .reset-btn:hover {
            background: #c0392b;
        }

        /* Attack Button Style */
        .menu-btn.attack-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .menu-btn.attack-btn:hover {
            box-shadow: 0 3px 15px rgba(231, 76, 60, 0.5);
        }

        /* Enemy Country Cards */
        .enemy-country {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .enemy-country:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Scrollable attack countries list */
        #attack-countries-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        #attack-countries-list::-webkit-scrollbar {
            width: 8px;
        }

        #attack-countries-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        #attack-countries-list::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }

        #attack-countries-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        .enemy-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .enemy-flag {
            font-size: 2rem;
        }

        .enemy-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .enemy-army {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .attack-country-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .attack-country-btn:hover {
            transform: scale(1.05);
        }

        /* Battle Result */
        .battle-result-content {
            text-align: center;
            padding: 20px;
        }

        .battle-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .battle-status {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .battle-status.victory {
            color: #4CAF50;
        }

        .battle-status.defeat {
            color: #e74c3c;
        }

        .battle-details {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .battle-detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .battle-detail-row:last-child {
            border-bottom: none;
        }

        .battle-reward {
            color: #4CAF50;
            font-weight: bold;
        }

        .battle-loss {
            color: #e74c3c;
            font-weight: bold;
        }

        /* Quests Button Style */
        .menu-btn.quests-btn {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .menu-btn.quests-btn:hover {
            box-shadow: 0 3px 15px rgba(243, 156, 18, 0.5);
        }

        /* Quests Styles */
        .quest-category {
            margin-bottom: 25px;
        }

        .quest-category-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255,255,255,0.2);
            color: #f39c12;
        }

        .quest-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .quest-item.completed {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
        }

        .quest-info {
            flex: 1;
        }

        .quest-name {
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .quest-progress {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .quest-reward {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .quest-reward.claimed {
            background: #4CAF50;
        }

        .claim-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .claim-btn:hover {
            transform: scale(1.05);
        }

        .quest-check {
            color: #4CAF50;
            font-size: 1.5rem;
        }

        /* Attack Setup Styles */
        .attack-setup-row {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .attack-setup-row label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .input-group {
            display: flex;
            gap: 5px;
            align-items: center;
            margin-bottom: 8px;
        }

        .input-group input {
            width: 80px;
            padding: 8px;
            border: none;
            border-radius: 5px;
            text-align: center;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .adjust-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .adjust-btn:hover {
            transform: scale(1.05);
        }

        .adjust-btn.max-btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .available {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .total-power {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .launch-attack-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.3rem;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .launch-attack-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(231, 76, 60, 0.5);
        }

        .enemy-forces {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .enemy-forces-title {
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Attacking Progress Screen */
        .attacking-content {
            text-align: center;
            padding: 30px 20px;
        }

        .attacking-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .attacking-title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #e74c3c;
        }

        .attacking-target {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .progress-container {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .progress-bar {
            height: 30px;
            background: linear-gradient(90deg, #e74c3c, #c0392b);
            border-radius: 12px;
            width: 0%;
            transition: width 0.1s linear;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 50px;
        }

        .progress-text {
            font-size: 2rem;
            font-weight: bold;
            margin-top: 20px;
            color: #e74c3c;
        }

        .attacking-status {
            font-size: 1rem;
            opacity: 0.7;
            margin-top: 15px;
        }

        /* Code Button Style */
        .menu-btn.code-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
        }

        .menu-btn.code-btn:hover {
            box-shadow: 0 3px 15px rgba(155, 89, 182, 0.5);
        }

        /* Team Button Style */
        .menu-btn.team-btn {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
        }

        .menu-btn.team-btn:hover {
            box-shadow: 0 3px 15px rgba(0, 184, 148, 0.5);
        }

        /* Team Modal Styles */
        .team-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .team-option-btn {
            padding: 20px;
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .team-option-btn.create-btn {
            background: linear-gradient(135deg, #00b894, #00a085);
        }

        .team-option-btn.join-btn {
            background: linear-gradient(135deg, #0984e3, #0773c7);
        }

        .team-option-btn:hover {
            transform: scale(1.02);
        }

        .team-form-group {
            margin-bottom: 15px;
        }

        .team-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            opacity: 0.9;
        }

        .team-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .team-input:focus {
            border-color: #00b894;
        }

        .team-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .team-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.3s;
            resize: vertical;
            min-height: 80px;
        }

        .team-textarea:focus {
            border-color: #00b894;
        }

        .team-textarea::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .privacy-toggle {
            display: flex;
            gap: 10px;
        }

        .privacy-option {
            flex: 1;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .privacy-option:hover {
            background: rgba(255,255,255,0.2);
        }

        .privacy-option.selected {
            border-color: #00b894;
            background: rgba(0, 184, 148, 0.3);
        }

        .team-code-display {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-top: 10px;
        }

        .team-code-display .code {
            font-size: 1.8rem;
            font-weight: bold;
            color: #00b894;
            letter-spacing: 5px;
        }

        .create-team-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .create-team-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 20px rgba(0, 184, 148, 0.5);
        }

        .team-display {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .team-display-name {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00b894;
            margin-bottom: 10px;
        }

        .team-display-desc {
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .team-display-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
        }

        .team-display-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .team-display-badge.public {
            background: rgba(9, 132, 227, 0.3);
            color: #74b9ff;
        }

        .team-display-badge.private {
            background: rgba(253, 121, 168, 0.3);
            color: #fd79a8;
        }

        .leave-team-btn {
            margin-top: 20px;
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .leave-team-btn:hover {
            transform: scale(1.05);
        }

        /* Team List Styles */
        .teams-list {
            max-height: 350px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .team-list-item {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .team-list-item:hover {
            background: rgba(255,255,255,0.15);
        }

        .team-list-item.active {
            border: 2px solid #00b894;
            background: rgba(0, 184, 148, 0.2);
        }

        .team-list-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .team-list-flag {
            font-size: 2rem;
        }

        .team-list-details {
            flex: 1;
        }

        .team-list-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 3px;
        }

        .team-list-desc {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .team-list-badge {
            font-size: 0.75rem;
            padding: 3px 8px;
            border-radius: 10px;
            margin-top: 5px;
            display: inline-block;
        }

        .team-list-badge.public {
            background: rgba(9, 132, 227, 0.3);
            color: #74b9ff;
        }

        .team-list-badge.private {
            background: rgba(253, 121, 168, 0.3);
            color: #fd79a8;
        }

        .team-join-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .team-join-btn:hover {
            transform: scale(1.05);
        }

        .team-join-btn.active {
            background: linear-gradient(135deg, #636e72, #4a5568);
            cursor: default;
        }

        .team-join-btn.active:hover {
            transform: none;
        }

        /* Country select in create team */
        .country-select-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            max-height: 150px;
            overflow-y: auto;
            padding: 5px;
        }

        .country-select-option {
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px 5px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .country-select-option:hover {
            background: rgba(255,255,255,0.2);
        }

        .country-select-option.selected {
            border-color: #00b894;
            background: rgba(0, 184, 148, 0.2);
        }

        .country-select-flag {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 3px;
        }

        .country-select-name {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        .no-teams-message {
            text-align: center;
            padding: 30px;
            opacity: 0.7;
        }

        /* Code Modal Styles */
        .code-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .code-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 1.1rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .code-input:focus {
            border-color: #9b59b6;
        }

        .code-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .redeem-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .redeem-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 15px rgba(155, 89, 182, 0.5);
        }

        .code-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            display: none;
        }

        .code-message.success {
            display: block;
            background: rgba(76, 175, 80, 0.3);
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }

        .code-message.error {
            display: block;
            background: rgba(231, 76, 60, 0.3);
            border: 1px solid #e74c3c;
            color: #e74c3c;
        }

        .redeemed-codes {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }

        .redeemed-codes h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        #redeemed-list {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .redeemed-code-item {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .redeemed-code-item:last-child {
            border-bottom: none;
        }

        /* Difficulty Labels */
        .enemy-difficulty {
            font-size: 0.8rem;
            font-weight: bold;
            margin: 3px 0;
        }

        .diff-easy {
            color: #4CAF50;
        }

        .diff-medium {
            color: #f39c12;
        }

        .diff-hard {
            color: #e67e22;
        }

        .diff-veryhard {
            color: #e74c3c;
        }

        .diff-boss {
            color: #9b59b6;
            font-size: 1rem;
            text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);
            animation: bossGlow 1.5s ease-in-out infinite;
        }

        @keyframes bossGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(155, 89, 182, 0.5); }
            50% { text-shadow: 0 0 20px rgba(155, 89, 182, 0.8), 0 0 30px rgba(155, 89, 182, 0.5); }
        }

        /* Boss Country Styling */
        .boss-country {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.3), rgba(142, 68, 173, 0.3));
            border: 2px solid #9b59b6;
            animation: bossBorder 2s ease-in-out infinite;
        }

        @keyframes bossBorder {
            0%, 100% { border-color: #9b59b6; box-shadow: 0 0 10px rgba(155, 89, 182, 0.3); }
            50% { border-color: #8e44ad; box-shadow: 0 0 20px rgba(155, 89, 182, 0.6); }
        }

        .boss-country .enemy-flag {
            font-size: 2.5rem;
        }

        .boss-country .enemy-name {
            color: #9b59b6;
            font-size: 1.3rem;
        }

        .boss-attack-btn {
            background: linear-gradient(135deg, #9b59b6, #8e44ad) !important;
            animation: bossButtonPulse 2s ease-in-out infinite;
        }

        @keyframes bossButtonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .boss-attack-btn:hover {
            box-shadow: 0 0 20px rgba(155, 89, 182, 0.7) !important;
        }

        /* Legendary Difficulty */
        .diff-legendary {
            color: #ff6b35;
            font-size: 1rem;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
            animation: legendaryGlow 1.5s ease-in-out infinite;
        }

        @keyframes legendaryGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(255, 107, 53, 0.5); }
            50% { text-shadow: 0 0 20px rgba(255, 107, 53, 0.8), 0 0 30px rgba(255, 107, 53, 0.5); }
        }

        /* Mythic Difficulty */
        .diff-mythic {
            color: #00d4ff;
            font-size: 1.1rem;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
            animation: mythicGlow 1.2s ease-in-out infinite;
        }

        @keyframes mythicGlow {
            0%, 100% { text-shadow: 0 0 15px rgba(0, 212, 255, 0.6); }
            50% { text-shadow: 0 0 25px rgba(0, 212, 255, 0.9), 0 0 40px rgba(0, 212, 255, 0.5); }
        }

        /* Impossible Difficulty */
        .diff-impossible {
            color: #ff0040;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 0, 64, 0.7);
            animation: impossibleGlow 0.8s ease-in-out infinite;
        }

        @keyframes impossibleGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255, 0, 64, 0.7), 0 0 40px rgba(255, 0, 64, 0.3); }
            50% { text-shadow: 0 0 30px rgba(255, 0, 64, 1), 0 0 60px rgba(255, 0, 64, 0.6); }
        }

        /* Superboss Country Styling */
        .superboss-country {
            background: linear-gradient(135deg, rgba(255, 0, 64, 0.4), rgba(139, 0, 0, 0.4));
            border: 3px solid #ff0040;
            animation: superbossBorder 1.5s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .superboss-country::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 0, 64, 0.1), transparent);
            animation: superbossShine 3s linear infinite;
        }

        @keyframes superbossShine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes superbossBorder {
            0%, 100% { border-color: #ff0040; box-shadow: 0 0 20px rgba(255, 0, 64, 0.5), inset 0 0 20px rgba(255, 0, 64, 0.1); }
            50% { border-color: #ff3366; box-shadow: 0 0 40px rgba(255, 0, 64, 0.8), inset 0 0 30px rgba(255, 0, 64, 0.2); }
        }

        .superboss-country .enemy-flag {
            font-size: 3rem;
            animation: superbossIcon 2s ease-in-out infinite;
        }

        @keyframes superbossIcon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .superboss-country .enemy-name {
            color: #ff0040;
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(255, 0, 64, 0.5);
        }

        .superboss-attack-btn {
            background: linear-gradient(135deg, #ff0040, #8b0000) !important;
            animation: superbossButtonPulse 1s ease-in-out infinite;
            font-size: 1.1rem !important;
        }

        @keyframes superbossButtonPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 0, 64, 0.5); }
            50% { transform: scale(1.08); box-shadow: 0 0 40px rgba(255, 0, 64, 0.8); }
        }

        .superboss-attack-btn:hover {
            box-shadow: 0 0 40px rgba(255, 0, 64, 0.9) !important;
        }

        /* Responsive Design */

        /* Tablets and small desktops */
        @media (max-width: 1024px) {
            .resources {
                gap: 15px;
            }

            .resource {
                padding: 6px 10px;
            }

            .units-grid {
                gap: 15px;
            }

            .right-menu {
                width: 70px;
                padding: 15px 8px;
            }

            .menu-btn {
                padding: 12px 8px;
                font-size: 0.7rem;
            }

            .menu-btn-icon {
                font-size: 1.3rem;
            }
        }

        /* Phones and small tablets */
        @media (max-width: 768px) {
            #country-selection h1 {
                font-size: 2rem;
                margin-bottom: 30px;
            }

            .countries-container {
                gap: 10px;
                max-width: 100%;
                padding: 0 10px;
            }

            .country-card {
                width: 100px;
                padding: 12px;
            }

            .country-flag {
                font-size: 2.5rem;
                margin-bottom: 8px;
            }

            .country-name {
                font-size: 0.9rem;
            }

            #start-btn {
                padding: 12px 40px;
                font-size: 1.2rem;
            }

            /* Game header */
            .game-header {
                flex-direction: column;
                gap: 10px;
                padding: 10px 15px;
            }

            .player-info {
                gap: 10px;
            }

            .player-flag {
                font-size: 1.5rem;
            }

            .player-country {
                font-size: 1.2rem;
            }

            .resources {
                gap: 8px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .resource {
                padding: 5px 8px;
                font-size: 0.85rem;
            }

            .resource-icon {
                font-size: 1rem;
            }

            .resource-value {
                font-size: 0.95rem;
            }

            /* Game content layout */
            .game-content {
                flex-direction: column;
                height: auto;
                min-height: calc(100vh - 120px);
            }

            .main-area {
                padding: 15px;
                order: 1;
            }

            .units-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin-top: 15px;
                max-width: 100%;
                width: 100%;
            }

            .army-display {
                padding: 15px;
            }

            .army-display h2 {
                font-size: 1rem;
            }

            .army-count {
                font-size: 1.8rem;
            }

            .army-icon {
                font-size: 1.5rem;
            }

            /* Right menu becomes bottom menu */
            .right-menu {
                width: 100%;
                flex-direction: row;
                order: 2;
                padding: 10px;
                gap: 8px;
                overflow-x: auto;
                justify-content: center;
                flex-wrap: wrap;
            }

            .menu-btn {
                padding: 10px 12px;
                font-size: 0.7rem;
                min-width: 60px;
            }

            .menu-btn-icon {
                font-size: 1.2rem;
                margin-bottom: 3px;
            }

            /* Modals */
            .modal {
                min-width: unset;
                max-width: 95vw;
                width: 95vw;
                max-height: 85vh;
                overflow-y: auto;
                padding: 20px;
                margin: 10px;
            }

            .modal-header h2 {
                font-size: 1.4rem;
            }

            .shop-item {
                padding: 12px;
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .shop-item-info {
                flex-direction: column;
                gap: 8px;
            }

            .buy-btn {
                width: 100%;
                padding: 10px;
            }

            /* Attack setup */
            .attack-setup-row {
                padding: 12px;
            }

            .input-group {
                flex-wrap: wrap;
                justify-content: center;
            }

            .input-group input {
                width: 60px;
                font-size: 1rem;
            }

            .adjust-btn {
                padding: 8px 10px;
                font-size: 0.9rem;
            }

            .total-power {
                font-size: 1.1rem;
                padding: 12px;
            }

            .launch-attack-btn {
                font-size: 1.1rem;
                padding: 12px;
            }

            /* Enemy list */
            .enemy-country {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .attack-country-btn {
                width: 100%;
            }

            /* Battle result */
            .battle-icon {
                font-size: 3.5rem;
            }

            .battle-status {
                font-size: 1.5rem;
            }

            /* Attacking progress */
            .attacking-icon {
                font-size: 3.5rem;
            }

            .attacking-title {
                font-size: 1.4rem;
            }

            .progress-text {
                font-size: 1.5rem;
            }

            /* Quests */
            .quest-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .claim-btn {
                width: 100%;
            }

            /* Stats */
            .stat-row {
                padding: 12px;
            }

            /* Settings */
            .setting-row {
                padding: 12px;
            }
        }

        /* Small phones */
        @media (max-width: 480px) {
            #country-selection h1 {
                font-size: 1.6rem;
                margin-bottom: 20px;
            }

            .countries-container {
                gap: 8px;
            }

            .country-card {
                width: 85px;
                padding: 10px;
            }

            .country-flag {
                font-size: 2rem;
                margin-bottom: 5px;
            }

            .country-name {
                font-size: 0.75rem;
            }

            #start-btn {
                padding: 10px 30px;
                font-size: 1rem;
            }

            .game-header {
                padding: 8px 10px;
            }

            .resources {
                gap: 5px;
            }

            .resource {
                padding: 4px 6px;
                font-size: 0.75rem;
            }

            .resource-icon {
                font-size: 0.9rem;
            }

            .resource-value {
                font-size: 0.85rem;
            }

            .units-grid {
                gap: 8px;
            }

            .army-display {
                padding: 10px;
            }

            .army-display h2 {
                font-size: 0.85rem;
                margin-bottom: 5px;
            }

            .army-count {
                font-size: 1.5rem;
            }

            .army-icon {
                font-size: 1.2rem;
            }

            .right-menu {
                padding: 8px;
                gap: 5px;
            }

            .menu-btn {
                padding: 8px;
                font-size: 0.6rem;
                min-width: 50px;
            }

            .menu-btn-icon {
                font-size: 1rem;
            }

            .modal {
                padding: 15px;
            }

            .modal-header h2 {
                font-size: 1.2rem;
            }

            .close-btn {
                font-size: 1.5rem;
            }

            .shop-item-icon {
                font-size: 1.5rem;
            }

            .shop-item-name {
                font-size: 1rem;
            }

            .input-group input {
                width: 50px;
                padding: 6px;
                font-size: 0.9rem;
            }

            .adjust-btn {
                padding: 6px 8px;
                font-size: 0.8rem;
            }

            .battle-details {
                padding: 12px;
            }

            .battle-detail-row {
                padding: 8px 0;
                font-size: 0.9rem;
            }

            .enemy-forces {
                padding: 10px;
            }
        }

        /* Landscape mode on phones */
        @media (max-height: 500px) and (orientation: landscape) {
            .game-content {
                flex-direction: row;
            }

            .main-area {
                order: 1;
            }

            .right-menu {
                width: 70px;
                flex-direction: column;
                order: 2;
                overflow-y: auto;
            }

            .units-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .modal {
                max-height: 90vh;
            }
        }
    </style>
</head>
<body>
    <!-- Country Selection Screen -->
    <div id="country-selection">
        <h1>Choose Your Country</h1>
        <div class="countries-container">
            <div class="country-card" data-country="Spain" data-flag="ðŸ‡ªðŸ‡¸">
                <div class="country-flag">ðŸ‡ªðŸ‡¸</div>
                <div class="country-name">Spain</div>
            </div>
            <div class="country-card" data-country="France" data-flag="ðŸ‡«ðŸ‡·">
                <div class="country-flag">ðŸ‡«ðŸ‡·</div>
                <div class="country-name">France</div>
            </div>
            <div class="country-card" data-country="Germany" data-flag="ðŸ‡©ðŸ‡ª">
                <div class="country-flag">ðŸ‡©ðŸ‡ª</div>
                <div class="country-name">Germany</div>
            </div>
            <div class="country-card" data-country="United Kingdom" data-flag="ðŸ‡¬ðŸ‡§">
                <div class="country-flag">ðŸ‡¬ðŸ‡§</div>
                <div class="country-name">United Kingdom</div>
            </div>
            <div class="country-card" data-country="Italy" data-flag="ðŸ‡®ðŸ‡¹">
                <div class="country-flag">ðŸ‡®ðŸ‡¹</div>
                <div class="country-name">Italy</div>
            </div>
            <div class="country-card" data-country="Lithuania" data-flag="ðŸ‡±ðŸ‡¹">
                <div class="country-flag">ðŸ‡±ðŸ‡¹</div>
                <div class="country-name">Lithuania</div>
            </div>
            <div class="country-card" data-country="Belgium" data-flag="ðŸ‡§ðŸ‡ª">
                <div class="country-flag">ðŸ‡§ðŸ‡ª</div>
                <div class="country-name">Belgium</div>
            </div>
            <div class="country-card" data-country="Poland" data-flag="ðŸ‡µðŸ‡±">
                <div class="country-flag">ðŸ‡µðŸ‡±</div>
                <div class="country-name">Poland</div>
            </div>
            <div class="country-card" data-country="Netherlands" data-flag="ðŸ‡³ðŸ‡±">
                <div class="country-flag">ðŸ‡³ðŸ‡±</div>
                <div class="country-name">Netherlands</div>
            </div>
            <div class="country-card" data-country="Russia" data-flag="ðŸ‡·ðŸ‡º">
                <div class="country-flag">ðŸ‡·ðŸ‡º</div>
                <div class="country-name">Russia</div>
            </div>
            <div class="country-card" data-country="China" data-flag="ðŸ‡¨ðŸ‡³">
                <div class="country-flag">ðŸ‡¨ðŸ‡³</div>
                <div class="country-name">China</div>
            </div>
            <div class="country-card" data-country="USA" data-flag="ðŸ‡ºðŸ‡¸">
                <div class="country-flag">ðŸ‡ºðŸ‡¸</div>
                <div class="country-name">USA</div>
            </div>
            <div class="country-card" data-country="Japan" data-flag="ðŸ‡¯ðŸ‡µ">
                <div class="country-flag">ðŸ‡¯ðŸ‡µ</div>
                <div class="country-name">Japan</div>
            </div>
            <div class="country-card" data-country="Brazil" data-flag="ðŸ‡§ðŸ‡·">
                <div class="country-flag">ðŸ‡§ðŸ‡·</div>
                <div class="country-name">Brazil</div>
            </div>
            <div class="country-card" data-country="India" data-flag="ðŸ‡®ðŸ‡³">
                <div class="country-flag">ðŸ‡®ðŸ‡³</div>
                <div class="country-name">India</div>
            </div>
            <div class="country-card" data-country="South Korea" data-flag="ðŸ‡°ðŸ‡·">
                <div class="country-flag">ðŸ‡°ðŸ‡·</div>
                <div class="country-name">South Korea</div>
            </div>
            <div class="country-card boss-card" data-country="Roman Empire" data-flag="ðŸ›ï¸">
                <div class="country-flag">ðŸ›ï¸</div>
                <div class="country-name">Roman Empire</div>
            </div>
            <div class="country-card boss-card" data-country="Mongol Empire" data-flag="ðŸŽ">
                <div class="country-flag">ðŸŽ</div>
                <div class="country-name">Mongol Empire</div>
            </div>
            <div class="country-card boss-card" data-country="Ottoman Empire" data-flag="ðŸŒ™">
                <div class="country-flag">ðŸŒ™</div>
                <div class="country-name">Ottoman Empire</div>
            </div>
            <div class="country-card mythic-card" data-country="British Empire" data-flag="ðŸ‘‘">
                <div class="country-flag">ðŸ‘‘</div>
                <div class="country-name">British Empire</div>
            </div>
            <div class="country-card superboss-card" data-country="Galactic Federation" data-flag="ðŸŒŒ">
                <div class="country-flag">ðŸŒŒ</div>
                <div class="country-name">Galactic Federation</div>
            </div>
        </div>
        <button id="start-btn">START GAME</button>
    </div>

    <!-- Game Screen -->
    <div id="game-screen">
        <div class="game-header">
            <div class="player-info">
                <span class="player-flag" id="player-flag">ðŸ‡ªðŸ‡¸</span>
                <span class="player-country" id="player-country">Spain</span>
            </div>
            <div class="resources">
                <div class="resource">
                    <span class="resource-icon">ðŸ’°</span>
                    <span class="resource-value" id="gold-display">1000</span>
                </div>
                <div class="resource">
                    <span class="resource-icon">âš”ï¸</span>
                    <span class="resource-value" id="army-header-display">10</span>
                </div>
                <div class="resource">
                    <span class="resource-icon">ðŸ›¡ï¸</span>
                    <span class="resource-value" id="tanks-header-display">0</span>
                </div>
                <div class="resource">
                    <span class="resource-icon">âœˆï¸</span>
                    <span class="resource-value" id="planes-header-display">0</span>
                </div>
                <div class="resource">
                    <span class="resource-icon">ðŸš¢</span>
                    <span class="resource-value" id="ships-header-display">0</span>
                </div>
            </div>
        </div>
        <div class="game-content">
            <div class="main-area">
                <div class="units-grid">
                    <div class="army-display">
                        <h2>Soldiers</h2>
                        <div class="army-count" id="army-display">10</div>
                        <div class="army-icon">âš”ï¸</div>
                    </div>
                    <div class="army-display">
                        <h2>Tanks</h2>
                        <div class="army-count" id="tanks-display" style="color: #f39c12;">0</div>
                        <div class="army-icon">ðŸ›¡ï¸</div>
                    </div>
                    <div class="army-display">
                        <h2>Planes</h2>
                        <div class="army-count" id="planes-display" style="color: #3498db;">0</div>
                        <div class="army-icon">âœˆï¸</div>
                    </div>
                    <div class="army-display">
                        <h2>Battleships</h2>
                        <div class="army-count" id="ships-display" style="color: #9b59b6;">0</div>
                        <div class="army-icon">ðŸš¢</div>
                    </div>
                </div>
            </div>
            <div class="right-menu">
                <button class="menu-btn attack-btn" onclick="openModal('attack')">
                    <span class="menu-btn-icon">âš”ï¸</span>
                    Attack
                </button>
                <button class="menu-btn" onclick="openModal('shop')">
                    <span class="menu-btn-icon">ðŸ›’</span>
                    Shop
                </button>
                <button class="menu-btn" onclick="openModal('stats')">
                    <span class="menu-btn-icon">ðŸ“Š</span>
                    Stats
                </button>
                <button class="menu-btn quests-btn" onclick="openModal('quests')">
                    <span class="menu-btn-icon">ðŸ“œ</span>
                    Quests
                </button>
                <button class="menu-btn" onclick="openModal('settings')">
                    <span class="menu-btn-icon">âš™ï¸</span>
                    Settings
                </button>
                <button class="menu-btn code-btn" onclick="openModal('code')">
                    <span class="menu-btn-icon">ðŸŽ</span>
                    Code
                </button>
                <button class="menu-btn team-btn" onclick="openModal('team')">
                    <span class="menu-btn-icon">ðŸ‘¥</span>
                    My Teams
                </button>
            </div>
        </div>
    </div>

    <!-- Shop Modal -->
    <div class="modal-overlay" id="shop-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>ðŸ›’ Shop</h2>
                <button class="close-btn" onclick="closeModal('shop')">&times;</button>
            </div>
            <div class="shop-item">
                <div class="shop-item-info">
                    <span class="shop-item-icon">ðŸ—¡ï¸</span>
                    <div>
                        <div class="shop-item-name">Infantry</div>
                        <div class="shop-item-desc">+10 Army</div>
                    </div>
                </div>
                <button class="buy-btn" onclick="buyArmy(10, 100)">ðŸ’° 100</button>
            </div>
            <div class="shop-item">
                <div class="shop-item-info">
                    <span class="shop-item-icon">ðŸ¹</span>
                    <div>
                        <div class="shop-item-name">Archers</div>
                        <div class="shop-item-desc">+25 Army</div>
                    </div>
                </div>
                <button class="buy-btn" onclick="buyArmy(25, 200)">ðŸ’° 200</button>
            </div>
            <div class="shop-item">
                <div class="shop-item-info">
                    <span class="shop-item-icon">ðŸ´</span>
                    <div>
                        <div class="shop-item-name">Cavalry</div>
                        <div class="shop-item-desc">+50 Army</div>
                    </div>
                </div>
                <button class="buy-btn" onclick="buyArmy(50, 350)">ðŸ’° 350</button>
            </div>
            <div class="shop-item">
                <div class="shop-item-info">
                    <span class="shop-item-icon">ðŸ°</span>
                    <div>
                        <div class="shop-item-name">Elite Knights</div>
                        <div class="shop-item-desc">+100 Army</div>
                    </div>
                </div>
                <button class="buy-btn" onclick="buyArmy(100, 600)">ðŸ’° 600</button>
            </div>
            <div class="shop-item" style="border: 2px solid #f39c12;">
                <div class="shop-item-info">
                    <span class="shop-item-icon">ðŸ›¡ï¸</span>
                    <div>
                        <div class="shop-item-name">Tank</div>
                        <div class="shop-item-desc">+1 Tank (= 50 power)</div>
                    </div>
                </div>
                <button class="buy-btn" onclick="buyUnit('tanks', 1, 300)">ðŸ’° 300</button>
            </div>
            <div class="shop-item" style="border: 2px solid #3498db;">
                <div class="shop-item-info">
                    <span class="shop-item-icon">âœˆï¸</span>
                    <div>
                        <div class="shop-item-name">Fighter Plane</div>
                        <div class="shop-item-desc">+1 Plane (= 75 power)</div>
                    </div>
                </div>
                <button class="buy-btn" onclick="buyUnit('planes', 1, 400)">ðŸ’° 400</button>
            </div>
            <div class="shop-item" style="border: 2px solid #9b59b6;">
                <div class="shop-item-info">
                    <span class="shop-item-icon">ðŸš¢</span>
                    <div>
                        <div class="shop-item-name">Battleship</div>
                        <div class="shop-item-desc">+1 Ship (= 100 power)</div>
                    </div>
                </div>
                <button class="buy-btn" onclick="buyUnit('ships', 1, 500)">ðŸ’° 500</button>
            </div>
        </div>
    </div>

    <!-- Stats Modal -->
    <div class="modal-overlay" id="stats-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>ðŸ“Š Stats</h2>
                <button class="close-btn" onclick="closeModal('stats')">&times;</button>
            </div>
            <div class="stat-row">
                <span class="stat-label">Country</span>
                <span class="stat-value" id="stat-country">Spain</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Gold</span>
                <span class="stat-value" id="stat-gold">1000</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Army Size</span>
                <span class="stat-value" id="stat-army">10</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Tanks</span>
                <span class="stat-value" id="stat-tanks" style="color: #f39c12;">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Planes</span>
                <span class="stat-value" id="stat-planes" style="color: #3498db;">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Battleships</span>
                <span class="stat-value" id="stat-ships" style="color: #9b59b6;">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Total Purchased</span>
                <span class="stat-value" id="stat-purchased">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Gold Spent</span>
                <span class="stat-value" id="stat-spent">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Battles Won</span>
                <span class="stat-value" id="stat-won" style="color: #4CAF50;">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Battles Lost</span>
                <span class="stat-value" id="stat-lost" style="color: #e74c3c;">0</span>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>âš™ï¸ Settings</h2>
                <button class="close-btn" onclick="closeModal('settings')">&times;</button>
            </div>
            <div class="setting-row">
                <span>Sound Effects</span>
                <button class="toggle-btn active" id="sound-toggle" onclick="toggleSetting(this)"></button>
            </div>
            <div class="setting-row">
                <span>Music</span>
                <button class="toggle-btn active" id="music-toggle" onclick="toggleSetting(this)"></button>
            </div>
            <div class="setting-row">
                <span>Notifications</span>
                <button class="toggle-btn" id="notif-toggle" onclick="toggleSetting(this)"></button>
            </div>
            <button class="reset-btn" onclick="resetGame()">Reset Game</button>
        </div>
    </div>

    <!-- Attack Modal -->
    <div class="modal-overlay" id="attack-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>âš”ï¸ Attack Country</h2>
                <button class="close-btn" onclick="closeModal('attack')">&times;</button>
            </div>
            <p style="margin-bottom: 20px; opacity: 0.8;">Choose a country to attack. Enemy forces are unknown!</p>
            <div id="attack-countries-list"></div>
        </div>
    </div>

    <!-- Attack Setup Modal -->
    <div class="modal-overlay" id="attack-setup-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>âš”ï¸ Prepare Attack</h2>
                <button class="close-btn" onclick="closeModal('attack-setup')">&times;</button>
            </div>
            <p style="margin-bottom: 15px;">Attacking: <strong id="target-country-name"></strong> <span id="target-country-flag"></span></p>

            <div class="attack-setup-row">
                <label>Soldiers to send:</label>
                <div class="input-group">
                    <button class="adjust-btn" onclick="adjustSoldiers(-10)">-10</button>
                    <input type="number" id="soldiers-input" value="10" min="1">
                    <button class="adjust-btn" onclick="adjustSoldiers(10)">+10</button>
                    <button class="adjust-btn max-btn" onclick="setMaxSoldiers()">MAX</button>
                </div>
                <span class="available">Available: <span id="available-soldiers">10</span></span>
            </div>

            <div class="attack-setup-row">
                <label>Tanks to send: <small>(50 power each)</small></label>
                <div class="input-group">
                    <button class="adjust-btn" onclick="adjustUnit('tanks', -1)">-1</button>
                    <input type="number" id="tanks-input" value="0" min="0" onchange="updateTotalPower()">
                    <button class="adjust-btn" onclick="adjustUnit('tanks', 1)">+1</button>
                    <button class="adjust-btn max-btn" onclick="setMaxUnit('tanks')">MAX</button>
                </div>
                <span class="available">Available: <span id="available-tanks">0</span></span>
            </div>

            <div class="attack-setup-row">
                <label>Planes to send: <small>(75 power each)</small></label>
                <div class="input-group">
                    <button class="adjust-btn" onclick="adjustUnit('planes', -1)">-1</button>
                    <input type="number" id="planes-input" value="0" min="0" onchange="updateTotalPower()">
                    <button class="adjust-btn" onclick="adjustUnit('planes', 1)">+1</button>
                    <button class="adjust-btn max-btn" onclick="setMaxUnit('planes')">MAX</button>
                </div>
                <span class="available">Available: <span id="available-planes">0</span></span>
            </div>

            <div class="attack-setup-row">
                <label>Battleships to send: <small>(100 power each)</small></label>
                <div class="input-group">
                    <button class="adjust-btn" onclick="adjustUnit('ships', -1)">-1</button>
                    <input type="number" id="ships-input" value="0" min="0" onchange="updateTotalPower()">
                    <button class="adjust-btn" onclick="adjustUnit('ships', 1)">+1</button>
                    <button class="adjust-btn max-btn" onclick="setMaxUnit('ships')">MAX</button>
                </div>
                <span class="available">Available: <span id="available-ships">0</span></span>
            </div>

            <div class="total-power">
                Total Attack Power: <span id="total-power">10</span>
            </div>

            <button class="launch-attack-btn" onclick="launchAttack()">ðŸš€ Launch Attack!</button>
        </div>
    </div>

    <!-- Battle Result Modal -->
    <div class="modal-overlay" id="battle-modal">
        <div class="modal" id="battle-modal-content">
            <div class="modal-header">
                <h2 id="battle-title">Battle Result</h2>
                <button class="close-btn" onclick="closeModal('battle')">&times;</button>
            </div>
            <div id="battle-result"></div>
        </div>
    </div>

    <!-- Attacking Progress Modal -->
    <div class="modal-overlay" id="attacking-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>âš”ï¸ Attacking...</h2>
            </div>
            <div class="attacking-content">
                <div class="attacking-icon">âš”ï¸</div>
                <div class="attacking-title">ATTACKING</div>
                <div class="attacking-target" id="attacking-target-display"></div>
                <div class="progress-container">
                    <div class="progress-bar" id="attack-progress-bar"></div>
                </div>
                <div class="progress-text" id="attack-progress-text">0%</div>
                <div class="attacking-status" id="attacking-status">Preparing forces...</div>
            </div>
        </div>
    </div>

    <!-- Quests Modal -->
    <div class="modal-overlay" id="quests-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>ðŸ“œ Quests</h2>
                <button class="close-btn" onclick="closeModal('quests')">&times;</button>
            </div>
            <div id="quests-content"></div>
        </div>
    </div>

    <!-- Code Redemption Modal -->
    <div class="modal-overlay" id="code-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>ðŸŽ Redeem Code</h2>
                <button class="close-btn" onclick="closeModal('code')">&times;</button>
            </div>
            <p style="margin-bottom: 20px; opacity: 0.8;">Enter a code to receive rewards!</p>
            <div class="code-input-container">
                <input type="text" id="code-input" placeholder="Enter code here..." class="code-input">
                <button class="redeem-btn" onclick="redeemCode()">Redeem</button>
            </div>
            <div id="code-message" class="code-message"></div>
            <div class="redeemed-codes">
                <h3>Redeemed Codes:</h3>
                <div id="redeemed-list"></div>
            </div>
        </div>
    </div>

    <!-- Team Modal -->
    <div class="modal-overlay" id="team-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>ðŸ‘¥ My Teams</h2>
                <button class="close-btn" onclick="closeModal('team')">&times;</button>
            </div>
            <div id="team-content">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Create Team Modal -->
    <div class="modal-overlay" id="create-team-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>âœ¨ Create Team</h2>
                <button class="close-btn" onclick="closeModal('create-team')">&times;</button>
            </div>
            <div class="team-form-group">
                <label>Team Name</label>
                <input type="text" id="team-name-input" class="team-input" placeholder="Enter team name..." maxlength="20">
            </div>
            <div class="team-form-group">
                <label>Team Country</label>
                <div class="country-select-grid" id="team-country-select">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
            <div class="team-form-group">
                <label>Description</label>
                <textarea id="team-desc-input" class="team-textarea" placeholder="Describe your team..." maxlength="100"></textarea>
            </div>
            <div class="team-form-group">
                <label>Privacy</label>
                <div class="privacy-toggle">
                    <button class="privacy-option selected" id="privacy-public" onclick="selectPrivacy('public')">ðŸŒ Public</button>
                    <button class="privacy-option" id="privacy-private" onclick="selectPrivacy('private')">ðŸ”’ Private</button>
                </div>
            </div>
            <div id="team-code-container" style="display: none;">
                <div class="team-code-display">
                    <p style="margin-bottom: 10px; opacity: 0.8;">Your team code:</p>
                    <div class="code" id="generated-team-code">00000</div>
                    <p style="margin-top: 10px; font-size: 0.9rem; opacity: 0.7;">Share this code with friends to join!</p>
                </div>
            </div>
            <button class="create-team-btn" onclick="createTeam()">ðŸš€ Create Team</button>
        </div>
    </div>

    <!-- Join Team Modal -->
    <div class="modal-overlay" id="join-team-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>ðŸ”— Join Team</h2>
                <button class="close-btn" onclick="closeModal('join-team')">&times;</button>
            </div>
            <p style="margin-bottom: 20px; opacity: 0.8;">Enter a team code to join a private team:</p>
            <div class="team-form-group">
                <label>Team Code</label>
                <input type="text" id="join-team-code" class="team-input" placeholder="Enter 5-digit code..." maxlength="5">
            </div>
            <div id="join-team-message" class="code-message"></div>
            <button class="create-team-btn" style="background: linear-gradient(135deg, #0984e3, #0773c7);" onclick="joinTeamByCode()">ðŸ”— Join Team</button>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            country: null,
            flag: null,
            gold: 1000,
            army: 10,
            tanks: 0,
            planes: 0,
            ships: 0,
            totalPurchased: 0,
            teams: [], // Array of { name, description, isPrivate, code, country, flag }
            activeTeamIndex: null, // Index of currently active team
            goldSpent: 0,
            battlesWon: 0,
            battlesLost: 0,
            questsCompleted: [],
            questLevel: 'starter',
            redeemedCodes: []
        };

        // Available codes
        const availableCodes = {
            'Free': { reward: 'army', amount: 10000, description: '+10,000 Army' },
            'Gogo': { reward: 'gold', amount: 10000, description: '+10,000 Gold' },
            'Gogojam': { reward: 'gold', amount: 100000, description: '+100,000 Gold' },
            'Justas': { reward: 'ships', amount: 1000, description: '+1,000 Battleships' }
        };

        // Save game to localStorage
        function saveGame() {
            if (gameState.country) {
                const saveKey = 'warGame_' + gameState.country;
                localStorage.setItem(saveKey, JSON.stringify(gameState));
            }
        }

        // Load game from localStorage
        function loadGame(country, flag) {
            const saveKey = 'warGame_' + country;
            const savedData = localStorage.getItem(saveKey);

            if (savedData) {
                const parsed = JSON.parse(savedData);
                gameState = parsed;
                // Ensure country and flag are set correctly
                gameState.country = country;
                gameState.flag = flag;
                return true;
            }
            return false;
        }

        // Quest definitions
        const starterQuests = [
            { id: 'attack_country', name: 'Attack a country', reward: 100, check: () => gameState.battlesWon + gameState.battlesLost >= 1 },
            { id: 'buy_10_army', name: 'Buy +10 army from shop', reward: 300, check: () => gameState.totalPurchased >= 10 },
            { id: 'get_100_army', name: 'Get 100 army', reward: 500, check: () => gameState.army >= 100 }
        ];

        const normalQuests = [
            { id: 'win_5_battles', name: 'Win 5 battles', reward: 800, check: () => gameState.battlesWon >= 5 },
            { id: 'get_500_army', name: 'Get 500 army', reward: 1500, check: () => gameState.army >= 500 },
            { id: 'spend_2000_gold', name: 'Spend 2000 gold in shop', reward: 1000, check: () => gameState.goldSpent >= 2000 }
        ];

        const hardQuests = [
            { id: 'win_15_battles', name: 'Win 15 battles', reward: 2000, check: () => gameState.battlesWon >= 15 },
            { id: 'get_2000_army', name: 'Get 2000 army', reward: 5000, check: () => gameState.army >= 2000 },
            { id: 'spend_10000_gold', name: 'Spend 10000 gold in shop', reward: 3000, check: () => gameState.goldSpent >= 10000 }
        ];

        // Country Selection
        const countryCards = document.querySelectorAll('.country-card');
        const startBtn = document.getElementById('start-btn');

        countryCards.forEach(card => {
            card.addEventListener('click', () => {
                countryCards.forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                gameState.country = card.dataset.country;
                gameState.flag = card.dataset.flag;
                startBtn.classList.add('active');
            });
        });

        // Start Game
        startBtn.addEventListener('click', () => {
            if (gameState.country) {
                // Try to load saved game for this country
                const country = gameState.country;
                const flag = gameState.flag;
                loadGame(country, flag);

                document.getElementById('country-selection').style.display = 'none';
                document.getElementById('game-screen').style.display = 'block';
                document.getElementById('player-flag').textContent = gameState.flag;
                document.getElementById('player-country').textContent = gameState.country;
                updateDisplays();
                saveGame(); // Save initial state
            }
        });

        // Update all displays
        function updateDisplays() {
            document.getElementById('gold-display').textContent = gameState.gold;
            document.getElementById('army-display').textContent = gameState.army;
            document.getElementById('army-header-display').textContent = gameState.army;
            document.getElementById('tanks-display').textContent = gameState.tanks;
            document.getElementById('tanks-header-display').textContent = gameState.tanks;
            document.getElementById('planes-display').textContent = gameState.planes;
            document.getElementById('planes-header-display').textContent = gameState.planes;
            document.getElementById('ships-display').textContent = gameState.ships;
            document.getElementById('ships-header-display').textContent = gameState.ships;
            document.getElementById('stat-country').textContent = gameState.country;
            document.getElementById('stat-gold').textContent = gameState.gold;
            document.getElementById('stat-army').textContent = gameState.army;
            document.getElementById('stat-tanks').textContent = gameState.tanks;
            document.getElementById('stat-planes').textContent = gameState.planes;
            document.getElementById('stat-ships').textContent = gameState.ships;
            document.getElementById('stat-purchased').textContent = gameState.totalPurchased;
            document.getElementById('stat-spent').textContent = gameState.goldSpent;
            document.getElementById('stat-won').textContent = gameState.battlesWon || 0;
            document.getElementById('stat-lost').textContent = gameState.battlesLost || 0;
        }

        // Modal Functions
        function openModal(type) {
            if (type === 'attack') {
                generateEnemyList();
            }
            if (type === 'quests') {
                renderQuests();
            }
            if (type === 'code') {
                renderRedeemedCodes();
                document.getElementById('code-input').value = '';
                document.getElementById('code-message').className = 'code-message';
            }
            if (type === 'team') {
                renderTeamContent();
            }
            document.getElementById(type + '-modal').classList.add('active');
            updateDisplays();
        }

        function closeModal(type) {
            document.getElementById(type + '-modal').classList.remove('active');
        }

        // Close modal when clicking outside
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });

        // Shop Functions
        function buyArmy(amount, cost) {
            if (gameState.gold >= cost) {
                gameState.gold -= cost;
                gameState.army += amount;
                gameState.totalPurchased += amount;
                gameState.goldSpent += cost;
                updateDisplays();
                saveGame();
            } else {
                alert('Not enough gold!');
            }
        }

        function buyUnit(unitType, amount, cost) {
            if (gameState.gold >= cost) {
                gameState.gold -= cost;
                gameState[unitType] += amount;
                gameState.goldSpent += cost;
                updateDisplays();
                saveGame();
            } else {
                alert('Not enough gold!');
            }
        }

        // Settings Functions
        function toggleSetting(btn) {
            btn.classList.toggle('active');
        }

        function resetGame() {
            if (confirm('Are you sure you want to reset the game?')) {
                // Clear saved data for this country
                if (gameState.country) {
                    localStorage.removeItem('warGame_' + gameState.country);
                }

                gameState = {
                    country: null,
                    flag: null,
                    gold: 1000,
                    army: 10,
                    tanks: 0,
                    planes: 0,
                    ships: 0,
                    totalPurchased: 0,
                    goldSpent: 0,
                    battlesWon: 0,
                    battlesLost: 0,
                    questsCompleted: [],
                    questLevel: 'starter',
                    redeemedCodes: [],
                    teams: [],
                    activeTeamIndex: null
                };
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('country-selection').style.display = 'flex';
                countryCards.forEach(c => c.classList.remove('selected'));
                startBtn.classList.remove('active');
                closeModal('settings');
            }
        }

        // Passive gold income
        setInterval(() => {
            if (gameState.country) {
                gameState.gold += 10;
                updateDisplays();
                saveGame();
            }
        }, 5000);

        // All countries data
        // Country data with difficulty levels
        // difficulty: 1 = easy, 2 = medium, 3 = hard, 4 = very hard, 5 = boss
        // difficulty: 1=easy, 2=medium, 3=hard, 4=very hard, 5=boss, 6=legendary, 7=mythic, 8=IMPOSSIBLE
        const allCountries = [
            { name: 'Spain', flag: 'ðŸ‡ªðŸ‡¸', difficulty: 1 },
            { name: 'France', flag: 'ðŸ‡«ðŸ‡·', difficulty: 1 },
            { name: 'Germany', flag: 'ðŸ‡©ðŸ‡ª', difficulty: 2 },
            { name: 'United Kingdom', flag: 'ðŸ‡¬ðŸ‡§', difficulty: 2 },
            { name: 'Italy', flag: 'ðŸ‡®ðŸ‡¹', difficulty: 1 },
            { name: 'Lithuania', flag: 'ðŸ‡±ðŸ‡¹', difficulty: 1 },
            { name: 'Belgium', flag: 'ðŸ‡§ðŸ‡ª', difficulty: 1 },
            { name: 'Poland', flag: 'ðŸ‡µðŸ‡±', difficulty: 2 },
            { name: 'Netherlands', flag: 'ðŸ‡³ðŸ‡±', difficulty: 2 },
            { name: 'Russia', flag: 'ðŸ‡·ðŸ‡º', difficulty: 3 },
            { name: 'China', flag: 'ðŸ‡¨ðŸ‡³', difficulty: 3 },
            { name: 'USA', flag: 'ðŸ‡ºðŸ‡¸', difficulty: 4 },
            { name: 'Japan', flag: 'ðŸ‡¯ðŸ‡µ', difficulty: 3 },
            { name: 'Brazil', flag: 'ðŸ‡§ðŸ‡·', difficulty: 3 },
            { name: 'India', flag: 'ðŸ‡®ðŸ‡³', difficulty: 4 },
            { name: 'South Korea', flag: 'ðŸ‡°ðŸ‡·', difficulty: 4 },
            { name: 'Roman Empire', flag: 'ðŸ›ï¸', difficulty: 5, isBoss: true },
            { name: 'Mongol Empire', flag: 'ðŸŽ', difficulty: 6, isBoss: true },
            { name: 'Ottoman Empire', flag: 'ðŸŒ™', difficulty: 6, isBoss: true },
            { name: 'British Empire', flag: 'ðŸ‘‘', difficulty: 7, isBoss: true },
            { name: 'Galactic Federation', flag: 'ðŸŒŒ', difficulty: 8, isBoss: true, isSuperboss: true }
        ];

        // Generate enemy countries list (excluding player's country)
        function generateEnemyList() {
            const container = document.getElementById('attack-countries-list');
            container.innerHTML = '';

            // Sort by difficulty
            const sortedCountries = [...allCountries].sort((a, b) => a.difficulty - b.difficulty);

            sortedCountries.forEach(country => {
                if (country.name !== gameState.country) {
                    const enemyDiv = document.createElement('div');
                    let extraClass = '';
                    if (country.isSuperboss) extraClass = ' superboss-country';
                    else if (country.isBoss) extraClass = ' boss-country';
                    enemyDiv.className = 'enemy-country' + extraClass;

                    // Difficulty label
                    let diffLabel = '';
                    let diffClass = '';
                    switch(country.difficulty) {
                        case 1: diffLabel = 'â­ Easy'; diffClass = 'diff-easy'; break;
                        case 2: diffLabel = 'â­â­ Medium'; diffClass = 'diff-medium'; break;
                        case 3: diffLabel = 'â­â­â­ Hard'; diffClass = 'diff-hard'; break;
                        case 4: diffLabel = 'â­â­â­â­ Very Hard'; diffClass = 'diff-veryhard'; break;
                        case 5: diffLabel = 'ðŸ’€ BOSS'; diffClass = 'diff-boss'; break;
                        case 6: diffLabel = 'ðŸ”¥ LEGENDARY'; diffClass = 'diff-legendary'; break;
                        case 7: diffLabel = 'âš¡ MYTHIC'; diffClass = 'diff-mythic'; break;
                        case 8: diffLabel = 'â˜ ï¸ IMPOSSIBLE'; diffClass = 'diff-impossible'; break;
                    }

                    enemyDiv.innerHTML = `
                        <div class="enemy-info">
                            <span class="enemy-flag">${country.flag}</span>
                            <div>
                                <div class="enemy-name">${country.name}</div>
                                <div class="enemy-difficulty ${diffClass}">${diffLabel}</div>
                                <div class="enemy-army">Forces: ???</div>
                            </div>
                        </div>
                        <button class="attack-country-btn ${country.isSuperboss ? 'superboss-attack-btn' : (country.isBoss ? 'boss-attack-btn' : '')}" onclick="selectTarget('${country.name}', '${country.flag}', ${country.difficulty}, ${country.isBoss || false}, ${country.isSuperboss || false})">âš”ï¸ Attack</button>
                    `;
                    container.appendChild(enemyDiv);
                }
            });
        }

        // Attack setup state
        let attackTarget = { name: '', flag: '', difficulty: 1, isBoss: false, isSuperboss: false };

        // Select target country and open setup
        function selectTarget(name, flag, difficulty = 1, isBoss = false, isSuperboss = false) {
            attackTarget = { name, flag, difficulty, isBoss, isSuperboss };
            closeModal('attack');

            document.getElementById('target-country-name').textContent = name;
            document.getElementById('target-country-flag').textContent = flag;
            document.getElementById('available-soldiers').textContent = gameState.army;
            document.getElementById('available-tanks').textContent = gameState.tanks;
            document.getElementById('available-planes').textContent = gameState.planes;
            document.getElementById('available-ships').textContent = gameState.ships;
            document.getElementById('soldiers-input').value = Math.min(10, gameState.army);
            document.getElementById('soldiers-input').max = gameState.army;
            document.getElementById('tanks-input').value = 0;
            document.getElementById('planes-input').value = 0;
            document.getElementById('ships-input').value = 0;

            updateTotalPower();
            openModal('attack-setup');
        }

        // Adjust soldiers
        function adjustSoldiers(amount) {
            const input = document.getElementById('soldiers-input');
            let newValue = parseInt(input.value) + amount;
            newValue = Math.max(1, Math.min(newValue, gameState.army));
            input.value = newValue;
            updateTotalPower();
        }

        // Adjust any unit
        function adjustUnit(unitType, amount) {
            const input = document.getElementById(unitType + '-input');
            let newValue = parseInt(input.value) + amount;
            newValue = Math.max(0, Math.min(newValue, gameState[unitType]));
            input.value = newValue;
            updateTotalPower();
        }

        // Set max soldiers
        function setMaxSoldiers() {
            document.getElementById('soldiers-input').value = gameState.army;
            updateTotalPower();
        }

        // Set max for any unit
        function setMaxUnit(unitType) {
            document.getElementById(unitType + '-input').value = gameState[unitType];
            updateTotalPower();
        }

        // Update total power display
        function updateTotalPower() {
            const soldiers = parseInt(document.getElementById('soldiers-input').value) || 0;
            const tanks = parseInt(document.getElementById('tanks-input').value) || 0;
            const planes = parseInt(document.getElementById('planes-input').value) || 0;
            const ships = parseInt(document.getElementById('ships-input').value) || 0;
            const totalPower = soldiers + (tanks * 50) + (planes * 75) + (ships * 100);
            document.getElementById('total-power').textContent = totalPower;
        }

        // Launch the attack
        function launchAttack() {
            const soldiersSent = parseInt(document.getElementById('soldiers-input').value) || 0;
            const tanksSent = parseInt(document.getElementById('tanks-input').value) || 0;
            const planesSent = parseInt(document.getElementById('planes-input').value) || 0;
            const shipsSent = parseInt(document.getElementById('ships-input').value) || 0;

            if (soldiersSent < 1) {
                alert('You must send at least 1 soldier!');
                return;
            }
            if (soldiersSent > gameState.army) {
                alert('Not enough soldiers!');
                return;
            }
            if (tanksSent > gameState.tanks) {
                alert('Not enough tanks!');
                return;
            }
            if (planesSent > gameState.planes) {
                alert('Not enough planes!');
                return;
            }
            if (shipsSent > gameState.ships) {
                alert('Not enough battleships!');
                return;
            }

            closeModal('attack-setup');

            // Show attacking progress screen
            document.getElementById('attacking-target-display').textContent = `${attackTarget.flag} ${attackTarget.name}`;
            openModal('attacking');

            // Animate progress bar over 5 seconds
            let progress = 0;
            const progressBar = document.getElementById('attack-progress-bar');
            const progressText = document.getElementById('attack-progress-text');
            const statusText = document.getElementById('attacking-status');

            const statusMessages = [
                'Preparing forces...',
                'Deploying troops...',
                'Engaging enemy...',
                'Battle in progress...',
                'Finalizing assault...'
            ];

            const interval = setInterval(() => {
                progress += 2; // 2% every 100ms = 100% in 5 seconds
                progressBar.style.width = progress + '%';
                progressText.textContent = progress + '%';

                // Update status message at different stages
                if (progress <= 20) statusText.textContent = statusMessages[0];
                else if (progress <= 40) statusText.textContent = statusMessages[1];
                else if (progress <= 60) statusText.textContent = statusMessages[2];
                else if (progress <= 80) statusText.textContent = statusMessages[3];
                else statusText.textContent = statusMessages[4];

                if (progress >= 100) {
                    clearInterval(interval);

                    // Close attacking modal and process battle
                    setTimeout(() => {
                        closeModal('attacking');
                        processBattleResult(soldiersSent, tanksSent, planesSent, shipsSent);
                    }, 300);
                }
            }, 100);
        }

        // Process battle result after progress completes
        function processBattleResult(soldiersSent, tanksSent, planesSent, shipsSent) {
            // Calculate player power
            const playerPower = soldiersSent + (tanksSent * 50) + (planesSent * 75) + (shipsSent * 100);

            // Difficulty multipliers
            const difficulty = attackTarget.difficulty || 1;
            const isBoss = attackTarget.isBoss || false;


            // Base multiplier based on difficulty
            // 1 = 0.5-0.8x, 2 = 0.8-1.2x, 3 = 1.2-1.8x, 4 = 1.8-2.5x, 5 (boss) = 3-5x
            const isSuperboss = attackTarget.isSuperboss || false;

            let diffMultiplier;
            switch(difficulty) {
                case 1: diffMultiplier = 0.5 + Math.random() * 0.3; break;
                case 2: diffMultiplier = 0.8 + Math.random() * 0.4; break;
                case 3: diffMultiplier = 1.2 + Math.random() * 0.6; break;
                case 4: diffMultiplier = 1.8 + Math.random() * 0.7; break;
                case 5: diffMultiplier = 3 + Math.random() * 2; break; // Boss
                case 6: diffMultiplier = 5 + Math.random() * 3; break; // Legendary
                case 7: diffMultiplier = 8 + Math.random() * 4; break; // Mythic
                case 8: diffMultiplier = 15 + Math.random() * 5; break; // IMPOSSIBLE - Superboss
                default: diffMultiplier = 0.5 + Math.random() * 0.3;
            }

            // Generate enemy forces based on difficulty
            let baseSoldiers = Math.floor(playerPower * diffMultiplier);

            // Superboss (Galactic Federation) has minimum requirements: 20,000 soldiers + 2,000 ships
            if (isSuperboss) {
                baseSoldiers = Math.max(baseSoldiers, 20000);
            }
            const enemySoldiers = Math.max(10, baseSoldiers + Math.floor(Math.random() * 50 * difficulty));
            const enemyTanks = Math.floor((tanksSent + difficulty) * diffMultiplier) + Math.floor(Math.random() * difficulty * 2);
            const enemyPlanes = Math.floor((planesSent + difficulty) * diffMultiplier) + Math.floor(Math.random() * difficulty * 2);
            let enemyShips = Math.floor((shipsSent + Math.floor(difficulty / 2)) * diffMultiplier) + Math.floor(Math.random() * difficulty);

            // Superboss has minimum 2000 ships
            if (isSuperboss) {
                enemyShips = Math.max(enemyShips, 2000);
            }

            // Boss gets extra bonus units (more for higher difficulties)
            let bossBonus = 0;
            if (isSuperboss) {
                bossBonus = 5000 + Math.floor(Math.random() * 5000); // Superboss: 5000-10000 extra
            } else if (isBoss) {
                bossBonus = 500 * (difficulty - 4) + Math.floor(Math.random() * 500 * (difficulty - 4));
            }
            const enemyPower = (enemySoldiers + bossBonus) + (enemyTanks * 50) + (enemyPlanes * 75) + (enemyShips * 100);

            // Battle calculation - player with superior force should win more often
            // Give player a bonus based on power advantage
            const powerRatio = playerPower / Math.max(enemyPower, 1);
            const playerBonus = Math.floor(playerPower * 0.1 * Math.min(powerRatio, 3)); // Up to 30% bonus if 3x stronger
            const playerRoll = playerPower + playerBonus + Math.floor(Math.random() * 100);
            const enemyRoll = enemyPower + Math.floor(Math.random() * (50 + difficulty * 20));

            const victory = playerRoll > enemyRoll;

            // Calculate losses and gains
            let losses = {}, gained = {}, goldReward;

            if (victory) {
                losses.soldiers = Math.floor(soldiersSent * (0.1 + Math.random() * 0.2));
                losses.tanks = Math.floor(tanksSent * Math.random() * 0.2);
                losses.planes = Math.floor(planesSent * Math.random() * 0.2);
                losses.ships = Math.floor(shipsSent * Math.random() * 0.15);

                gained.soldiers = Math.floor(enemySoldiers * 0.5);
                gained.tanks = Math.floor(enemyTanks * 0.3);
                gained.planes = Math.floor(enemyPlanes * 0.25);
                gained.ships = Math.floor(enemyShips * 0.2);

                // Gold reward scales with difficulty
                const baseGold = 200 * difficulty * difficulty; // Exponential scaling
                const bonusGold = Math.floor(Math.random() * 500 * difficulty);
                let bossGoldBonus = 0;
                if (isSuperboss) bossGoldBonus = 50000; // Superboss gives 50k gold
                else if (difficulty >= 7) bossGoldBonus = 20000;
                else if (difficulty >= 6) bossGoldBonus = 10000;
                else if (isBoss) bossGoldBonus = 5000;
                goldReward = baseGold + bonusGold + bossGoldBonus;

                gameState.army = gameState.army - losses.soldiers + gained.soldiers;
                gameState.tanks = gameState.tanks - losses.tanks + gained.tanks;
                gameState.planes = gameState.planes - losses.planes + gained.planes;
                gameState.ships = gameState.ships - losses.ships + gained.ships;
                gameState.gold += goldReward;
                gameState.battlesWon = (gameState.battlesWon || 0) + 1;
            } else {
                losses.soldiers = Math.floor(soldiersSent * (0.4 + Math.random() * 0.3));
                losses.tanks = Math.floor(tanksSent * (0.3 + Math.random() * 0.3));
                losses.planes = Math.floor(planesSent * (0.3 + Math.random() * 0.3));
                losses.ships = Math.floor(shipsSent * (0.25 + Math.random() * 0.25));
                gained = { soldiers: 0, tanks: 0, planes: 0, ships: 0 };
                goldReward = 0;

                gameState.army = Math.max(1, gameState.army - losses.soldiers);
                gameState.tanks = Math.max(0, gameState.tanks - losses.tanks);
                gameState.planes = Math.max(0, gameState.planes - losses.planes);
                gameState.ships = Math.max(0, gameState.ships - losses.ships);
                gameState.battlesLost = (gameState.battlesLost || 0) + 1;
            }

            // Show battle result
            showBattleResult(victory, attackTarget.name, attackTarget.flag,
                { soldiers: enemySoldiers, tanks: enemyTanks, planes: enemyPlanes, ships: enemyShips, power: enemyPower },
                losses, gained, goldReward);
            updateDisplays();
            saveGame();
        }

        // Show battle result modal
        function showBattleResult(victory, enemyName, enemyFlag, enemyForces, losses, gained, goldReward) {
            const resultDiv = document.getElementById('battle-result');
            const title = document.getElementById('battle-title');

            title.textContent = victory ? 'ðŸŽ‰ Victory!' : 'ðŸ’€ Defeat!';

            resultDiv.innerHTML = `
                <div class="battle-result-content">
                    <div class="battle-icon">${victory ? 'ðŸ†' : 'ðŸ’”'}</div>
                    <div class="battle-status ${victory ? 'victory' : 'defeat'}">
                        ${victory ? 'You Won!' : 'You Lost!'}
                    </div>
                    <p>Battle against ${enemyFlag} ${enemyName}</p>

                    <div class="enemy-forces">
                        <div class="enemy-forces-title">Enemy Forces Revealed:</div>
                        <div class="battle-detail-row">
                            <span>âš”ï¸ Soldiers</span>
                            <span>${enemyForces.soldiers}</span>
                        </div>
                        <div class="battle-detail-row">
                            <span>ðŸ›¡ï¸ Tanks</span>
                            <span>${enemyForces.tanks}</span>
                        </div>
                        <div class="battle-detail-row">
                            <span>âœˆï¸ Planes</span>
                            <span>${enemyForces.planes}</span>
                        </div>
                        <div class="battle-detail-row">
                            <span>ðŸš¢ Ships</span>
                            <span>${enemyForces.ships}</span>
                        </div>
                        <div class="battle-detail-row">
                            <span>ðŸ’ª Total Power</span>
                            <span>${enemyForces.power}</span>
                        </div>
                    </div>

                    <div class="battle-details">
                        <div class="battle-detail-row">
                            <span>Soldier Losses</span>
                            <span class="battle-loss">-${losses.soldiers}</span>
                        </div>
                        ${losses.tanks > 0 ? `
                        <div class="battle-detail-row">
                            <span>Tank Losses</span>
                            <span class="battle-loss">-${losses.tanks}</span>
                        </div>
                        ` : ''}
                        ${losses.planes > 0 ? `
                        <div class="battle-detail-row">
                            <span>Plane Losses</span>
                            <span class="battle-loss">-${losses.planes}</span>
                        </div>
                        ` : ''}
                        ${losses.ships > 0 ? `
                        <div class="battle-detail-row">
                            <span>Ship Losses</span>
                            <span class="battle-loss">-${losses.ships}</span>
                        </div>
                        ` : ''}
                        ${victory ? `
                        <div class="battle-detail-row">
                            <span>Soldiers Captured</span>
                            <span class="battle-reward">+${gained.soldiers}</span>
                        </div>
                        ${gained.tanks > 0 ? `
                        <div class="battle-detail-row">
                            <span>Tanks Captured</span>
                            <span class="battle-reward">+${gained.tanks}</span>
                        </div>
                        ` : ''}
                        ${gained.planes > 0 ? `
                        <div class="battle-detail-row">
                            <span>Planes Captured</span>
                            <span class="battle-reward">+${gained.planes}</span>
                        </div>
                        ` : ''}
                        ${gained.ships > 0 ? `
                        <div class="battle-detail-row">
                            <span>Ships Captured</span>
                            <span class="battle-reward">+${gained.ships}</span>
                        </div>
                        ` : ''}
                        <div class="battle-detail-row">
                            <span>Gold Looted</span>
                            <span class="battle-reward">+${goldReward}</span>
                        </div>
                        ` : ''}
                        <div class="battle-detail-row" style="border-top: 1px solid rgba(255,255,255,0.2); margin-top: 10px; padding-top: 15px;">
                            <span>Your Forces Now</span>
                            <span>âš”ï¸${gameState.army} ðŸ›¡ï¸${gameState.tanks} âœˆï¸${gameState.planes} ðŸš¢${gameState.ships}</span>
                        </div>
                    </div>
                </div>
            `;

            openModal('battle');
        }

        // Get current quests based on level
        function getCurrentQuests() {
            if (gameState.questLevel === 'starter') return starterQuests;
            if (gameState.questLevel === 'normal') return normalQuests;
            if (gameState.questLevel === 'hard') return hardQuests;
            return [];
        }

        // Get quest level title
        function getQuestLevelTitle() {
            if (gameState.questLevel === 'starter') return 'ðŸŒŸ Starter Quests';
            if (gameState.questLevel === 'normal') return 'âš”ï¸ Normal Quests';
            if (gameState.questLevel === 'hard') return 'ðŸ”¥ Hard Quests';
            return 'ðŸ† All Quests Completed!';
        }

        // Check if all current quests are completed
        function checkQuestLevelComplete() {
            const quests = getCurrentQuests();
            const allCompleted = quests.every(q => gameState.questsCompleted.includes(q.id));

            if (allCompleted) {
                if (gameState.questLevel === 'starter') {
                    gameState.questLevel = 'normal';
                } else if (gameState.questLevel === 'normal') {
                    gameState.questLevel = 'hard';
                } else if (gameState.questLevel === 'hard') {
                    gameState.questLevel = 'completed';
                }
            }
        }

        // Render quests in modal
        function renderQuests() {
            const container = document.getElementById('quests-content');
            const quests = getCurrentQuests();
            const title = getQuestLevelTitle();

            if (gameState.questLevel === 'completed') {
                container.innerHTML = `
                    <div class="quest-category">
                        <div class="quest-category-title">ðŸ† All Quests Completed!</div>
                        <p style="text-align: center; opacity: 0.8; padding: 20px;">
                            Congratulations! You have completed all quests!<br>
                            You are a true conqueror!
                        </p>
                    </div>
                `;
                return;
            }

            let html = `<div class="quest-category"><div class="quest-category-title">${title}</div>`;

            quests.forEach(quest => {
                const isComplete = quest.check();
                const isClaimed = gameState.questsCompleted.includes(quest.id);

                html += `
                    <div class="quest-item ${isClaimed ? 'completed' : ''}">
                        <div class="quest-info">
                            <div class="quest-name">${quest.name}</div>
                            <div class="quest-progress">${isComplete ? 'âœ… Completed' : 'â³ In Progress'}</div>
                        </div>
                        ${isClaimed
                            ? '<span class="quest-check">âœ“</span>'
                            : isComplete
                                ? `<button class="claim-btn" onclick="claimQuest('${quest.id}', ${quest.reward})">Claim ðŸ’°${quest.reward}</button>`
                                : `<span class="quest-reward">ðŸ’° ${quest.reward}</span>`
                        }
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;
        }

        // Claim quest reward
        function claimQuest(questId, reward) {
            if (!gameState.questsCompleted.includes(questId)) {
                gameState.questsCompleted.push(questId);
                gameState.gold += reward;
                checkQuestLevelComplete();
                renderQuests();
                updateDisplays();
                saveGame();
            }
        }

        // Redeem code function
        function redeemCode() {
            const input = document.getElementById('code-input');
            const message = document.getElementById('code-message');
            const code = input.value.trim();

            // Reset message
            message.className = 'code-message';
            message.textContent = '';

            if (!code) {
                message.className = 'code-message error';
                message.textContent = 'Please enter a code!';
                return;
            }

            // Check if code already redeemed
            if (gameState.redeemedCodes && gameState.redeemedCodes.includes(code)) {
                message.className = 'code-message error';
                message.textContent = 'Code already redeemed!';
                return;
            }

            // Check if code exists
            if (availableCodes[code]) {
                const codeData = availableCodes[code];

                // Apply reward
                if (codeData.reward === 'army') {
                    gameState.army += codeData.amount;
                } else if (codeData.reward === 'gold') {
                    gameState.gold += codeData.amount;
                } else if (codeData.reward === 'tanks') {
                    gameState.tanks += codeData.amount;
                } else if (codeData.reward === 'planes') {
                    gameState.planes += codeData.amount;
                } else if (codeData.reward === 'ships') {
                    gameState.ships += codeData.amount;
                }

                // Mark code as redeemed
                if (!gameState.redeemedCodes) {
                    gameState.redeemedCodes = [];
                }
                gameState.redeemedCodes.push(code);

                // Show success message
                message.className = 'code-message success';
                message.textContent = `Code redeemed! ${codeData.description}`;

                // Clear input
                input.value = '';

                // Update displays and save
                updateDisplays();
                saveGame();
                renderRedeemedCodes();
            } else {
                message.className = 'code-message error';
                message.textContent = 'Invalid code!';
            }
        }

        // Render redeemed codes list
        function renderRedeemedCodes() {
            const list = document.getElementById('redeemed-list');
            if (!gameState.redeemedCodes || gameState.redeemedCodes.length === 0) {
                list.innerHTML = '<p style="opacity: 0.5;">No codes redeemed yet</p>';
            } else {
                list.innerHTML = gameState.redeemedCodes.map(code => {
                    const codeData = availableCodes[code];
                    const desc = codeData ? codeData.description : 'Unknown reward';
                    return `<div class="redeemed-code-item">âœ“ ${code} - ${desc}</div>`;
                }).join('');
            }
        }

        // Team functionality
        let selectedPrivacy = 'public';
        let generatedTeamCode = '';
        let selectedTeamCountry = null;
        let selectedTeamFlag = null;

        // Countries for team selection
        const teamCountries = [
            { name: 'Spain', flag: 'ðŸ‡ªðŸ‡¸' },
            { name: 'France', flag: 'ðŸ‡«ðŸ‡·' },
            { name: 'Germany', flag: 'ðŸ‡©ðŸ‡ª' },
            { name: 'UK', flag: 'ðŸ‡¬ðŸ‡§' },
            { name: 'Italy', flag: 'ðŸ‡®ðŸ‡¹' },
            { name: 'Lithuania', flag: 'ðŸ‡±ðŸ‡¹' },
            { name: 'Belgium', flag: 'ðŸ‡§ðŸ‡ª' },
            { name: 'Poland', flag: 'ðŸ‡µðŸ‡±' },
            { name: 'Netherlands', flag: 'ðŸ‡³ðŸ‡±' },
            { name: 'Russia', flag: 'ðŸ‡·ðŸ‡º' },
            { name: 'China', flag: 'ðŸ‡¨ðŸ‡³' },
            { name: 'USA', flag: 'ðŸ‡ºðŸ‡¸' },
            { name: 'Japan', flag: 'ðŸ‡¯ðŸ‡µ' },
            { name: 'Brazil', flag: 'ðŸ‡§ðŸ‡·' },
            { name: 'Canada', flag: 'ðŸ‡¨ðŸ‡¦' },
            { name: 'Australia', flag: 'ðŸ‡¦ðŸ‡º' }
        ];

        // Render team modal content
        function renderTeamContent() {
            const container = document.getElementById('team-content');

            // Initialize teams array if not exists
            if (!gameState.teams) {
                gameState.teams = [];
            }

            let html = '';

            // Show teams list if there are teams
            if (gameState.teams.length > 0) {
                html += '<div class="teams-list">';
                gameState.teams.forEach((team, index) => {
                    const isActive = gameState.activeTeamIndex === index;
                    html += `
                        <div class="team-list-item ${isActive ? 'active' : ''}">
                            <div class="team-list-info">
                                <span class="team-list-flag">${team.flag}</span>
                                <div class="team-list-details">
                                    <div class="team-list-name">${team.name}</div>
                                    <div class="team-list-desc">${team.description || 'No description'}</div>
                                    <span class="team-list-badge ${team.isPrivate ? 'private' : 'public'}">
                                        ${team.isPrivate ? 'ðŸ”’ Private' : 'ðŸŒ Public'}
                                    </span>
                                    ${team.isPrivate ? `<span style="margin-left: 10px; font-size: 0.8rem; opacity: 0.7;">Code: ${team.code}</span>` : ''}
                                </div>
                            </div>
                            <button class="team-join-btn ${isActive ? 'active' : ''}" onclick="${isActive ? '' : `joinTeam(${index})`}">
                                ${isActive ? 'âœ“ Active' : 'â†’ Join'}
                            </button>
                        </div>
                    `;
                });
                html += '</div>';
            } else {
                html += '<div class="no-teams-message">You don\'t have any teams yet.</div>';
            }

            // Show create/join buttons
            html += `
                <div class="team-options" style="margin-top: 15px;">
                    <button class="team-option-btn create-btn" onclick="openCreateTeam()">
                        âœ¨ Create Team
                    </button>
                    <button class="team-option-btn join-btn" onclick="openJoinTeam()">
                        ðŸ”— Join Team
                    </button>
                </div>
            `;

            container.innerHTML = html;
        }

        // Populate country select grid
        function populateTeamCountrySelect() {
            const container = document.getElementById('team-country-select');
            container.innerHTML = teamCountries.map(country => `
                <div class="country-select-option" onclick="selectTeamCountry('${country.name}', '${country.flag}', this)">
                    <span class="country-select-flag">${country.flag}</span>
                    <span class="country-select-name">${country.name}</span>
                </div>
            `).join('');
        }

        // Select team country
        function selectTeamCountry(name, flag, element) {
            selectedTeamCountry = name;
            selectedTeamFlag = flag;

            // Remove selected class from all options
            document.querySelectorAll('.country-select-option').forEach(opt => {
                opt.classList.remove('selected');
            });

            // Add selected class to clicked option
            element.classList.add('selected');
        }

        // Open create team modal
        function openCreateTeam() {
            closeModal('team');
            // Reset form
            document.getElementById('team-name-input').value = '';
            document.getElementById('team-desc-input').value = '';
            selectedTeamCountry = null;
            selectedTeamFlag = null;
            selectPrivacy('public');
            populateTeamCountrySelect();
            openModal('create-team');
        }

        // Open join team modal
        function openJoinTeam() {
            closeModal('team');
            document.getElementById('join-team-code').value = '';
            document.getElementById('join-team-message').className = 'code-message';
            openModal('join-team');
        }

        // Select privacy option
        function selectPrivacy(privacy) {
            selectedPrivacy = privacy;
            document.getElementById('privacy-public').classList.toggle('selected', privacy === 'public');
            document.getElementById('privacy-private').classList.toggle('selected', privacy === 'private');

            const codeContainer = document.getElementById('team-code-container');
            if (privacy === 'private') {
                // Generate random 5-digit code
                generatedTeamCode = String(Math.floor(10000 + Math.random() * 90000));
                document.getElementById('generated-team-code').textContent = generatedTeamCode;
                codeContainer.style.display = 'block';
            } else {
                generatedTeamCode = '';
                codeContainer.style.display = 'none';
            }
        }

        // Create team
        function createTeam() {
            const name = document.getElementById('team-name-input').value.trim();
            const description = document.getElementById('team-desc-input').value.trim();

            if (!name) {
                alert('Please enter a team name!');
                return;
            }

            if (!selectedTeamCountry) {
                alert('Please select a country for your team!');
                return;
            }

            // Initialize teams array if not exists
            if (!gameState.teams) {
                gameState.teams = [];
            }

            const newTeam = {
                name: name,
                description: description,
                country: selectedTeamCountry,
                flag: selectedTeamFlag,
                isPrivate: selectedPrivacy === 'private',
                code: selectedPrivacy === 'private' ? generatedTeamCode : null
            };

            gameState.teams.push(newTeam);
            gameState.activeTeamIndex = gameState.teams.length - 1; // Auto-join the new team

            saveGame();
            closeModal('create-team');
            openModal('team');
        }

        // Join team (switch active team)
        function joinTeam(index) {
            gameState.activeTeamIndex = index;
            saveGame();
            renderTeamContent();
        }

        // Join team by code
        function joinTeamByCode() {
            const code = document.getElementById('join-team-code').value.trim();
            const message = document.getElementById('join-team-message');

            if (!code || code.length !== 5) {
                message.className = 'code-message error';
                message.textContent = 'Please enter a valid 5-digit code!';
                return;
            }

            // Initialize teams array if not exists
            if (!gameState.teams) {
                gameState.teams = [];
            }

            // In a real app, this would check against a server
            // For now, we'll create a team with that code
            const newTeam = {
                name: 'Team ' + code,
                description: 'Joined via code',
                country: 'Unknown',
                flag: 'ðŸ³ï¸',
                isPrivate: true,
                code: code
            };

            gameState.teams.push(newTeam);
            gameState.activeTeamIndex = gameState.teams.length - 1;

            saveGame();
            message.className = 'code-message success';
            message.textContent = 'Successfully joined team!';

            setTimeout(() => {
                closeModal('join-team');
                openModal('team');
            }, 1000);
        }

    </script>
</body>
</html>
